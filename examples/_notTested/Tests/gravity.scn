<?xml version="1.0"?>
<Node name="root" dt="0.002" gravity="0 -981 0">
 	
	<RequiredPlugin pluginName="BeamAdapter"/>
	<VisualStyle displayFlags="hideVisualModels hideBehaviorModels showCollisionModels hideMappings hideForceFields hideWireFrame" />
	<FreeMotionAnimationLoop />
	<GenericConstraintSolver tolerance="1e-4"  maxIterations="100" unbuilt="false" printLog="0"/>
	<CollisionPipeline depth="6" verbose="1" draw="0"/>
	<BruteForceDetection name="N2" />
	<LocalMinDistance name="localmindistance" alarmDistance="0.08" contactDistance="0.05" coneFactor="0.5" angleCone="0.1" filterIntersection="true"/>
	<CollisionResponse name="Response" response="FrictionContact"  />
	<!--<RuleBasedContactManager name="Response" response="FrictionContact" rules="0 * FrictionContact?mu=0.2" />-->
	<CollisionGroup name="Group" />

	<Node name="Surf2">
		<MeshObjLoader name="loader" filename="mesh/dragon_clean.obj" triangulate="true" />
		<Mesh src="@loader" />
		<MechanicalObject name="Surf2MO" src="@loader" scale="0.20" dy="-3" dx="4" dz="-0.50"/>
		<Triangle/> 
		<Line/>
		<Point/>
		<RigidMapping index="1"/>
	</Node>


	<Node name="topoLines_suture">
		<WireRestShape template="Rigid" printLog="0" name="sutureRestShape" length="8"  straightLength="8" spireDiameter="4000.0" spireHeight="0.0"
					    densityOfBeams="15 0" numEdges="150" numEdgesCollis="150 0"  youngModulus="100000" youngModulusExtremity="10000"/> <!-- silicone -->		

		<EdgeSetTopologyContainer name="meshLinesSuture" />
		<EdgeSetTopologyModifier   name="Modifier" />
		<EdgeSetTopologyAlgorithms name="TopoAlgo"   template="Rigid" />
		<EdgeSetGeometryAlgorithms name="GeomAlgo"   template="Rigid" />
		<MechanicalObject template="Rigid" name="dofTopo1" />
	</Node>	

	<Node name="AdaptiveBeam">
		<EulerImplicit rayleighStiffness="0.04" rayleighMass="0.02" printLog="false" />
		<BTDLinearSolver subpartSolve="0" verification="0" verbose="0"/> 

		<EdgeSetTopologyContainer name="meshSuture" />


		
		<MechanicalObject template="Rigid" name="DOFs" showIndices="0"/> 

		<WireBeamInterpolation name="InterpolSuture" WireRestShape="@../topoLines_suture/sutureRestShape" radius="0.05" printLog="0" dofsAndBeamsAligned="false"/> 
		<AdaptiveBeamForceFieldAndMass name="SutureForceField" interpolation="@InterpolSuture" massDensity="1.0" elongationFactor="10" />
		<SutureController template="Rigid" name="m_ircontroller" printLog="0"  startingPos="0 0 -0.8 0 0 0 1" interpolation="@InterpolSuture"  threshold="1e-3" maxBendingAngle="0.4"/>
		
		

		<LinearSolverConstraintCorrection printLog="false" wire_optimization="true"/>

		
		
		<Node name="Collis">
				<RegularGrid name="test"
				nx="120" ny="1" nz="1"
				xmin="0.0" xmax="8"
				ymin="0" ymax="0"
				zmin="0" zmax="0"
				/>
				<MechanicalObject name="CollisionDOFs" />
				<AdaptiveBeamMapping  name="collisMap"  interpolation="@../InterpolSuture" useCurvAbs="1" printLog="0" mapForces="0" mapMasses="0"/> 
				<Line proximity="0.0" group="1"  selfCollision="1" />
				<Point proximity="0.0" group="1" selfCollision="1"/>
		</Node>	

		<Node name="VisuSuture">
			<MechanicalObject name="Quads" />
			<QuadSetTopologyContainer  name="ContainerSuture" />
			<QuadSetTopologyModifier   name="Modifier" />
			<QuadSetTopologyAlgorithms name="TopoAlgo"  template="Vec3d" />
			<QuadSetGeometryAlgorithms name="GeomAlgo"  template="Vec3d" />
			<Edge2QuadTopologicalMapping nbPointsOnEachCircle="6" radius="0.03" input="@../../topoLines_suture/meshLinesSuture" output="@ContainerSuture" flipNormals="true"/>
			<AdaptiveBeamMapping  name="VisuMapCath" useCurvAbs="1" printLog="0" interpolation="@../InterpolSuture" input="@../DOFs" output="@Quads" isMechanical="false"  mapForces="0" mapMasses="0"/>

			<Node name="VisuOgl">
				<VisualModel  name="VisualBody" />
				<IdentityMapping input="@../Quads" output="@VisualBody"/>
			</Node>	
		</Node>
	</Node>
   

</Node>

