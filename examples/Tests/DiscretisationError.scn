<?xml version="1.0"?>
<Node name="root" dt="0.01" gravity="0 0 -9810" >
	
	<RequiredPlugin pluginName="BeamAdapter"/>
	<VisualStyle displayFlags="showBehaviorModels hideVisualModels" />
	<FreeMotionAnimationLoop />
	<GenericConstraintSolver tolerance="1e-2"  />
	<CollisionPipeline depth="6" verbose="0" draw="0"/>
	<BruteForceBroadPhase/>
	<BVHNarrowPhase/>
	<LocalMinDistance name="Proximity" alarmDistance="10" contactDistance="1.7" coneFactor="0.3" angleCone="0.01" filterIntersection="true" />
	<RuleBasedContactManager name="Response" response="FrictionContact" rules="10 * NeedleContact" />

	<Node name="TopoLines_suture">
		<WireRestShape template="Rigid" printLog="0" name="sutureRestShape" length="200"  straightLength="170" spireDiameter="5e10" spireHeight="0.0"
					    densityOfBeams="10 10 0" numEdges="100" numEdgesCollis="50 0"  youngModulus="1e5" youngModulusExtremity="5e11"/>	

		<EdgeSetTopologyContainer name="meshLinesSuture" />
		<EdgeSetTopologyModifier   name="Modifier" />
		<EdgeSetTopologyAlgorithms name="TopoAlgo"   template="Rigid" />
		<EdgeSetGeometryAlgorithms name="GeomAlgo"   template="Rigid" />
		<MechanicalObject template="Rigid" name="dofTopo1" />
	</Node>	
	
	<Node name="Needle">
		<EulerImplicit rayleighStiffness="0.08" rayleighMass="0.08" />
		<BTDLinearSolver subpartSolve="0" /> 
		
		<EdgeSetTopologyContainer name="meshSuture" />
		<EdgeSetTopologyModifier   name="Modifier" />
		<EdgeSetTopologyAlgorithms name="TopoAlgo"   template="Rigid" />
		<EdgeSetGeometryAlgorithms name="GeomAlgo"   template="Rigid" />	
		
		<MechanicalObject template="Rigid" name="DOFs" /> 
		
		<LinearSolverConstraintCorrection wire_optimization="true"/>

		<WireBeamInterpolation name="interpolSuture" WireRestShape="@../TopoLines_suture/sutureRestShape" radius="2" printLog="0" dofsAndBeamsAligned="false"/> 
		<AdaptiveBeamForceFieldAndMass name="sutureForceField" interpolation="@interpolSuture" massDensity="1e-4"/>
		<SutureController template="Rigid" name="m_ircontroller" printLog="0"  startingPos="-170 0 0 0 0 0 1" interpolation="@interpolSuture"  threshold="0.1" maxBendingAngle="0.2"/>
		
		<Node name="Collis">
			<RegularGrid name="grid"
			nx="50" ny="1" nz="1"
			xmin="0.0" xmax="200"
			ymin="0" ymax="0"
			zmin="0" zmax="0"
			/>
			<MechanicalObject name="points" showIndices="0"/>
			<AdaptiveBeamMapping  name="collisMap"  interpolation="@../interpolSuture" useCurvAbs="1" printLog="0" mapForces="0" mapMasses="0"/> 
			<Line proximity="0.0" LineActiverPath="../container" />
			<Point proximity="0.0" PointActiverPath="../container" group="10" />
		</Node>		
		<Node name="VisuSuture">
			<MechanicalObject name="Quads" />
			<QuadSetTopologyContainer  name="ContainerSuture" />
			<QuadSetTopologyModifier   name="Modifier" />
			<QuadSetTopologyAlgorithms name="TopoAlgo"  template="Vec3d" />
			<QuadSetGeometryAlgorithms name="GeomAlgo"  template="Vec3d" />
			<Edge2QuadTopologicalMapping nbPointsOnEachCircle="10" radius=".5" input="@../../TopoLines_suture/meshLinesSuture" output="@ContainerSuture" flipNormals="true"/>
			<AdaptiveBeamMapping  name="VisuMapCath" useCurvAbs="1" printLog="0" interpolation="@../interpolSuture" input="@../DOFs" output="@Quads" isMechanical="false"  />

			<Node name="VisuOgl">
				<OglModel name="Visual" color="0.6 0.6 0.6" />
				<IdentityMapping input="@../Quads" output="@Visual" />
			</Node>
		</Node>
		<AdaptiveSutureContainer name="container" tipAbscissa="200" penetration="0" points="@Collis/points" interpolation="@interpolSuture" constraints_distance="75" friction_internal="0"/>
	<!--	<HoldingConstraint object1="@/articulatedObject1/6D_DOFs1/6D_Dof" object2="@DOFs" fixed="170" startingIndex="1" doNotModifyState="1"/>	-->
		<HoldingConstraint fixed="170" maxForce="0" />
	</Node>

</Node>
